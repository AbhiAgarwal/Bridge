(function(a){function b(b,c){this.timeline=a(b);this.settings=a.extend({},a.fn.dpSocialTimeline.defaults,c);var d=this.settings.feeds;var e=this.settings.custom;this.feeds=new Array;this.custom=new Array;this.social=new Array;for(x in this.settings.feeds){this.feeds[x+"_arr"]=d[x].data.split(",");if(typeof d[x].limit!=="undefined"){try{if(isNaN(d[x].limit)){this.feeds[x+"_limit"]=d[x].limit.split(",")}else{this.feeds[x+"_limit"]=d[x].limit}}catch(f){}}if(typeof this.feeds[x+"_limit"]==="undefined"){this.feeds[x+"_limit"]=0}this.feeds[x+"_url"]=new Array}for(x in this.settings.custom){this.custom[x+"_url"]=new Array(e[x].url);this.custom[x+"_name"]=new Array(e[x].name);this.custom[x+"_icon"]=new Array(e[x].icon);this.custom[x+"_limit"]=e[x].limit;this.social.push({name:this.custom[x+"_name"],url:this.custom[x+"_url"],id:x,icon:this.custom[x+"_icon"],limit:this.custom[x+"_limit"]})}this.totalFeeds=0;this.nameFeeds=new Array;this.iconFeeds=new Array;this.limitFeeds=new Array;this.entry=new Array;this.settings.itemWidthOrig=this.settings.itemWidth;var g=new String(window.document.location);if(g.indexOf("https://")!=-1)this.prefix="https://";else this.prefix="http://";switch(this.settings.layoutMode){case"timeline":this.settings.layoutMode="spineAlign";if(this.settings.timelineItemWidth!=""){this.settings.itemWidth=this.settings.timelineItemWidth}break;case"columns":this.settings.layoutMode="masonry";if(this.settings.columnsItemWidth!=""){this.settings.itemWidth=this.settings.columnsItemWidth}break;case"one_column":this.settings.layoutMode="straightDown";if(this.settings.oneColumnItemWidth!=""){this.settings.itemWidth=this.settings.oneColumnItemWidth}break}this.timeline.addClass(this.settings.skin);this.init()}b.prototype={init:function(){if(this.feeds["twitter_arr"]){for(var b=0;b<this.feeds["twitter_arr"].length;b++){this.feeds["twitter_url"][b]="http://api.twitter.com/1/statuses/user_timeline.rss?screen_name="+a.trim(this.feeds["twitter_arr"][b])}this.social.push({name:this.feeds["twitter_arr"],url:this.feeds["twitter_url"],id:"twitter",icon:"",limit:this.feeds["twitter_limit"]})}if(this.feeds["twitter_hash_arr"]){for(var b=0;b<this.feeds["twitter_hash_arr"].length;b++){this.feeds["twitter_hash_url"][b]="https://search.twitter.com/search.atom?q=%23"+a.trim(this.feeds["twitter_hash_arr"][b])}this.social.push({name:this.feeds["twitter_hash_arr"],url:this.feeds["twitter_hash_url"],id:"twitter",icon:"",limit:this.feeds["twitter_hash_limit"]})}if(this.feeds["facebook_page_arr"]){for(var b=0;b<this.feeds["facebook_page_arr"].length;b++){this.feeds["facebook_page_url"][b]="http://www.facebook.com/feeds/page.php?id="+a.trim(this.feeds["facebook_page_arr"][b])+"&format=atom10"}this.social.push({name:this.feeds["facebook_page_arr"],url:this.feeds["facebook_page_url"],id:"facebook",icon:"",limit:this.feeds["facebook_page_limit"]})}if(this.feeds["delicious_arr"]){for(var b=0;b<this.feeds["delicious_arr"].length;b++){this.feeds["delicious_url"][b]="http://feeds.delicious.com/v2/rss/"+a.trim(this.feeds["delicious_arr"][b])}this.social.push({name:this.feeds["delicious_arr"],url:this.feeds["delicious_url"],id:"delicious",icon:"",limit:this.feeds["delicious_limit"]})}if(this.feeds["flickr_arr"]){for(var b=0;b<this.feeds["flickr_arr"].length;b++){this.feeds["flickr_url"][b]="http://api.flickr.com/services/feeds/photos_public.gne?id="+a.trim(this.feeds["flickr_arr"][b])+"&format=rss_200"}this.social.push({name:this.feeds["flickr_arr"],url:this.feeds["flickr_url"],id:"flickr",icon:"",limit:this.feeds["flickr_limit"]})}if(this.feeds["tumblr_arr"]){for(var b=0;b<this.feeds["tumblr_arr"].length;b++){this.feeds["tumblr_url"][b]="http://"+a.trim(this.feeds["tumblr_arr"][b])+".tumblr.com/rss"}this.social.push({name:this.feeds["tumblr_arr"],url:this.feeds["tumblr_url"],id:"tumblr",icon:"",limit:this.feeds["tumblr_limit"]})}if(this.feeds["youtube_arr"]){for(var b=0;b<this.feeds["youtube_arr"].length;b++){this.feeds["youtube_url"][b]="http://gdata.youtube.com/feeds/base/users/"+a.trim(this.feeds["youtube_arr"][b])+"/uploads"}this.social.push({name:this.feeds["youtube_arr"],url:this.feeds["youtube_url"],id:"youtube",icon:"",limit:this.feeds["youtube_limit"]})}if(this.feeds["youtube_search_arr"]){for(var b=0;b<this.feeds["youtube_search_arr"].length;b++){this.feeds["youtube_search_url"][b]="http://gdata.youtube.com/feeds/api/videos?alt=atom&racy=include&vq="+a.trim(this.feeds["youtube_search_arr"][b])}this.social.push({name:this.feeds["youtube_search_arr"],url:this.feeds["youtube_search_url"],id:"youtube",icon:"",limit:this.feeds["youtube_search_limit"]})}if(this.feeds["dribbble_arr"]){for(var b=0;b<this.feeds["dribbble_arr"].length;b++){this.feeds["dribbble_url"][b]="http://dribbble.com/players/"+a.trim(this.feeds["dribbble_arr"][b])+"/shots.rss"}this.social.push({name:this.feeds["dribbble_arr"],url:this.feeds["dribbble_url"],id:"dribbble",icon:"",limit:this.feeds["dribbble_limit"]})}if(this.feeds["digg_arr"]){for(var b=0;b<this.feeds["digg_arr"].length;b++){this.feeds["digg_url"][b]="http://digg.com/users/"+a.trim(this.feeds["digg_arr"][b])+"/history.rss"}this.social.push({name:this.feeds["digg_arr"],url:this.feeds["digg_url"],id:"digg",icon:"",limit:this.feeds["digg_limit"]})}if(this.feeds["pinterest_arr"]){for(var b=0;b<this.feeds["pinterest_arr"].length;b++){this.feeds["pinterest_url"][b]="http://www.pinterest.com/"+a.trim(this.feeds["pinterest_arr"][b])+"/feed.rss"}this.social.push({name:this.feeds["pinterest_arr"],url:this.feeds["pinterest_url"],id:"pinterest",icon:"",limit:this.feeds["pinterest_limit"]})}if(this.feeds["vimeo_arr"]){for(var b=0;b<this.feeds["vimeo_arr"].length;b++){this.feeds["vimeo_url"][b]="http://vimeo.com/"+a.trim(this.feeds["vimeo_arr"][b])+"/videos/rss"}this.social.push({name:this.feeds["vimeo_arr"],url:this.feeds["vimeo_url"],id:"vimeo",icon:"",limit:this.feeds["vimeo_limit"]})}this.timeline.addClass("dpSocialTimelineLoading");this._parseFeeds()},_addSocial:function(a){var b=this;if(this.social[a].name!=""){this.nameFeeds[this.totalFeeds]=this.social[a].id;this.iconFeeds[this.totalFeeds]=this.social[a].icon;this.limitFeeds[this.totalFeeds]=this.social[a].limit;this.totalFeeds++;for(var c=0;c<this.social[a].url.length;c++){this._parseRSS(this.social[a].url[c],this.social[a].limit,c,function(c,d){if(!c){return false}for(var e=0;e<c.entries.length;e++){c.entries[e].name=b.social[a].id;c.entries[e].icon=b.social[a].icon;c.entries[e].limit=b.social[a].limit;if(c.entries[e].author==""){c.entries[e].author=b.social[a].name[d]}if(c.entries[e].title!=""){b.entry.push(c.entries[e])}}if(d==b.social[a].url.length-1){if(parseInt(a,10)==b.social.length-1){b._output()}else{b._addSocial(a+1)}}},this.settings.total)}}else{if(parseInt(a,10)==this.social.length-1){this._output()}else{this._addSocial(a+1)}}},_parseFeeds:function(){this._addSocial(0)},_output:function(){var b=this,c=false,d=false,e,f,g={$dpSocialTimelineLine:"",$dpSocialTimelineFilter:"",$dpSocialTimelineLayout:"",$dpSocialTimelineLineWrap:"",$dpSocialTimelineContent:"",$div:"",showDivider:false,appendFilter:false,appendLayout:false},h,i,j,k,l,m,n,o=new Array;g.$div=a("<div>").addClass("dpSocialTimeline");g.$dpSocialTimelineLine=a("<div />").addClass("dpSocialTimeline_line");g.$dpSocialTimelineLineWrap=a("<div />").addClass("dpSocialTimeline_lineWrap").append(a(g.$dpSocialTimelineLine));a(g.$div).append(g.$dpSocialTimelineLineWrap);this.entry.sort(function(a,b){a=(new Date(a["publishedDate"])).getTime();b=(new Date(b["publishedDate"])).getTime();return a==b?0:a>b?-1:1});this._createMarkup(g,0,false);a(".dpSocialTimeline_item",g.$div).width(this.settings.itemWidth);if(this.settings.showFilter&&this.totalFeeds>1){g.$dpSocialTimelineFilter=a("<div />").addClass("dpSocialTimeline_filter");for(var p=0;p<=this.totalFeeds;p++){if(typeof this.nameFeeds[p]!=="undefined"&&a.inArray(this.nameFeeds[p],o)===-1){g.$dpSocialTimelineFilter.append(a("<button />").attr({"data-filter":"."+this.nameFeeds[p]}).append(a("<span />").addClass("favicon "+this.nameFeeds[p])));if(typeof this.iconFeeds[p]!="undefined"&&this.iconFeeds[p]!=""){a("."+this.nameFeeds[p],g.$dpSocialTimelineFilter).css("background-image","url("+this.iconFeeds[p]+")")}o[p]=this.nameFeeds[p]}}if(o.length>1){g.appendFilter=true;g.showDivider=true}}if(this.settings.showLayout){g.$dpSocialTimelineLayout=a("<div />").addClass("dpSocialTimeline_layout");if(this.settings.showLayoutTimeline){g.$dpSocialTimelineLayout.append(a("<button />").attr({"data-style":"spineAlign"}).addClass("spineAlign").append(a("<span />")))}if(this.settings.showLayoutColumns){g.$dpSocialTimelineLayout.append(a("<button />").attr({"data-style":"masonry"}).addClass("masonry").append(a("<span />")))}if(this.settings.showLayoutOneColumn){g.$dpSocialTimelineLayout.append(a("<button />").attr({"data-style":"straightDown"}).addClass("straightDown").append(a("<span />")))}g.appendLayout=true;g.showDivider=true}if(a.browser.msie||a.browser.opera){a(document).ready(function(){b._onLoadHook(g)})}else{a(window).load(function(){b._onLoadHook(g)})}a("button",g.$dpSocialTimelineFilter).click(function(){if(!a(this).hasClass("active")){a(this).addClass("active")}else{a(this).removeClass("active")}var c="";a(".dpSocialTimeline_item.filtered",g.$div).removeClass("filtered");a("button.active",g.$dpSocialTimelineFilter).each(function(b){if(a(this).attr("data-filter")!=""&&typeof a(this).attr("data-filter")!=="undefined"){if(b>0){c+=","}c+=a(this).attr("data-filter");a(".dpSocialTimeline_item"+a(this).attr("data-filter"),g.$div).addClass("filtered")}});if(c==""){c=".dpSocialTimeline_item:lt("+b.settings.total+")";g.$div.isotope({filter:c});a(".dpSocialTimeline_item:gt("+(b.settings.total-1)+")",g.$div).css({opacity:0,scale:.001,display:"block"})}else{c=".filtered:lt("+b.settings.total+")";g.$div.isotope({filter:c});a(".dpSocialTimeline_item.filtered:gt("+(b.settings.total-1)+")",g.$div).css({opacity:0,scale:.001,display:"none"});a(".dpSocialTimeline_item.filtered:lt("+b.settings.total+")",g.$div).css({opacity:1,scale:1,display:"block"})}return false});if(this.settings.showLayout){a("button",g.$dpSocialTimelineLayout).click(function(){a("button",g.$dpSocialTimelineLayout).removeClass("active");a(this).addClass("active");if(a(this).attr("data-style")!=""&&typeof a(this).attr("data-style")!=="undefined"){switch(a(this).attr("data-style")){case"spineAlign":g.$dpSocialTimelineLineWrap.fadeIn("fast");if(b.settings.timelineItemWidth!=""){a(".dpSocialTimeline_item",g.$div).width(b.settings.timelineItemWidth)}else{a(".dpSocialTimeline_item",g.$div).width(b.settings.itemWidthOrig)}break;case"masonry":g.$dpSocialTimelineLineWrap.fadeOut("fast");if(b.settings.columnsItemWidth!=""){a(".dpSocialTimeline_item",g.$div).width(b.settings.columnsItemWidth)}else{a(".dpSocialTimeline_item",g.$div).width(b.settings.itemWidthOrig)}break;case"straightDown":g.$dpSocialTimelineLineWrap.fadeOut("fast");if(b.settings.oneColumnItemWidth!=""){a(".dpSocialTimeline_item",g.$div).width(b.settings.oneColumnItemWidth)}else{a(".dpSocialTimeline_item",g.$div).width(b.settings.itemWidthOrig)}break}g.$div.isotope({layoutMode:a(this).attr("data-style")});if(a(".dpSocialTimeline_item.filtered",g.$div).length){a(".dpSocialTimeline_item.filtered:gt("+(b.settings.total-1)+")",g.$div).css({opacity:0,scale:.001,display:"none"});a(".dpSocialTimeline_item.filtered:lt("+b.settings.total+")",g.$div).css({opacity:1,scale:1,display:"block"})}else{a(".dpSocialTimeline_item:gt("+(b.settings.total-1)+")",g.$div).css({opacity:0,scale:.001,display:"none"})}}return false})}},_createMarkup:function(b,c,d){for(x=c;x<this.entry.length;x++){if(this.settings.showSocialIcons){$favicon=a("<span />").addClass("favicon "+this.entry[x].name);if(typeof this.entry[x].icon[c]!="undefined"&&this.entry[x].icon[c]!=""){a($favicon).css("background-image","url("+this.entry[x].icon[c]+")")}}else{$favicon=""}date_published=new Date(this.entry[x].publishedDate);published_parse=Date.UTC(date_published.getFullYear(),date_published.getMonth(),date_published.getDate(),date_published.getHours(),date_published.getMinutes());$time=a("<span />").addClass("time").html(this._relativeTime(published_parse));$permalink=a("<a />").addClass("permalink").attr({href:this.entry[x].link,target:"_blank"});if(this.entry[x].link.substr(0,28)=="http://www.youtube.com/watch"){is_youtube=true;this.entry[x].thumbnail="http://i.ytimg.com/vi/"+this._getYoutubeId(this.entry[x].link)+"/0.jpg";is_vimeo=false;$video_icon=a("<div />").addClass("video_icon")}else if(this.entry[x].link.substr(0,16)=="http://vimeo.com"){is_youtube=false;is_vimeo=true;$video_icon=a("<div />").addClass("video_icon")}else{is_youtube=false;is_vimeo=false;$video_icon=""}var e=this.entry[x].author;if(this.entry[x].name=="flickr"){e=this.entry[x].author.match(/\((.*?)\)/g)[0]}else{e=e.replace(/\((.*?)\)/g,"")}if(this.entry[x].name=="twitter"){e="@"+e}$stContentHead=a("<div />").addClass("dpSocialTimelineContentHead").append(a($favicon)).append(a("<span />").addClass("user").html(e).text()).append(a($permalink)).append(a("<div />").css("clear","both"));$stContentFoot=a("<div />").addClass("dpSocialTimelineContentFoot").append(a($time));if(this.entry[x].link.indexOf("twitter.com")!==-1){title=this._linkify(this.entry[x].title.replace(e.replace("@","")+": ",""))}else{title=this._linkify(this.entry[x].title)}b.$dpSocialTimelineContent=a("<div />").addClass("dpSocialTimelineContent").append(title);if(this._getImage(this.entry[x],false)!=""){$get_image=this._getImage(this.entry[x],false);$img_link=a("<a />").attr({href:this.entry[x].link,target:"_blank"}).addClass("img_link"+(is_youtube||is_vimeo?" youtube":""));a($img_link).append($get_image).append($video_icon);if(this.settings.addColorbox){a($img_link).addClass("addColorbox");if(is_youtube){a($img_link).attr({href:this._getYoutubeVideo(this.entry[x].link)})}else if(is_vimeo){a($img_link).attr({href:this._getVimeoVideo(this.entry[x].link)})}else{a($img_link).attr({href:this._getImage(this.entry[x],true)})}}b.$dpSocialTimelineContent.append(a("<br />")).append($img_link)}b.$dpSocialTimelineContent.append(a("<div />").css("clear","both"));$li=a("<div>").addClass((d?"dpSocialTimeline_hideMe ":"")+"dpSocialTimeline_item").addClass(this.entry[x].name).append(a($stContentHead)).append(a(b.$dpSocialTimelineContent)).append(a($stContentFoot)).attr({"data-timeline-time":(new Date(this.entry[x].publishedDate)).getTime()});a(b.$div).append($li)}},_onLoadHook:function(b){var c=this;if(b.appendFilter){a(c.timeline).append(b.$dpSocialTimelineFilter)}if(b.appendLayout){a(c.timeline).append(b.$dpSocialTimelineLayout)}if(b.showDivider){a(c.timeline).append(a("<div />").addClass("dpSocialTimeline_divider"))}a(c.timeline).append(b.$div);a(c.timeline).removeClass("dpSocialTimelineLoading");if(c.settings.layoutMode=="spineAlign")a(b.$dpSocialTimelineLineWrap).show();a(b.$div).isotope({itemSelector:".dpSocialTimeline_item",layoutMode:c.settings.layoutMode,itemPositionDataEnabled:true,getSortData:{time:function(a){return a.attr("data-timeline-time")}},sortBy:"time",sortAscending:false,spineAlign:{gutterWidth:20},onLayout:function(c,d){a(b.$dpSocialTimelineLayout).find("button[data-style='"+d.options.layoutMode+"']").addClass("active");a("span",b.$dpSocialTimelineLine).fadeOut("fast",function(){a(this).remove()});c.each(function(c){var d=a("<span />");b.$dpSocialTimelineLine.append(d.css({top:a(this).data("isotope-item-position").y+18}))})}});a(b.$div).isotope({filter:".dpSocialTimeline_item:lt("+c.settings.total+")"});a(".dpSocialTimeline_item:gt("+(c.settings.total-1)+")",b.$div).css({opacity:0,scale:.001});a(".dpSocialTimeline_item",b.$div).width(this.settings.itemWidth);if(c.settings.addColorbox){a(b.$div).find(".addColorbox").colorbox();a(b.$div).find(".addColorbox.youtube").colorbox({iframe:true,innerWidth:425,innerHeight:344})}},_parseRSS:function(b,c,d,e,f){if(b==null)return false;var g=this.prefix+"ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(b);if(c!=null&&c>0&&typeof c!="undefined")g+="&num="+c;else if(f!=null)g+="&num="+f;a.getJSON(g,function(a){if(typeof e=="function")e.call(this,a.responseData.feed,d);else return false})},_relativeTime:function(a){var b=a;var c=arguments.length>1?arguments[1]:new Date;var d=parseInt((Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes())-b)/1e3);var e="";if(d<60){e="less than minute ago"}else if(d<120){e="about a minute ago"}else if(d<60*60){e="about "+parseInt(d/60).toString()+" minutes ago"}else if(d<120*60){e="about an hour ago"}else if(d<24*60*60){e="about "+parseInt(d/3600).toString()+" hours ago"}else if(d<48*60*60){e="1 day ago"}else{e=parseInt(d/86400).toString()+" days ago"}return e},_getImage:function(b,c){var d=new Array;var e=/<img .*src=["\']([^ ^"^\']*)["\']/gi;var f;var g="";var h=b.content;var i=b.title;if(b.thumbnail!=""&&typeof b.thumbnail!=="undefined"){d[0]=b.thumbnail}else{while(f=e.exec(h)){d.push(f[1])}}if(d.length>0){var j=d[0];j=j.replace("_m.jpg",".jpg");j=j.replace("_b.jpg","_f.jpg");j=j.replace("_s.jpg","_b.jpg");if(j.indexOf("safe_image.php")!=-1){j=unescape(j.match(/url=([^&]+)/)[1])}if(j.indexOf("app_full_proxy.php")!=-1){j=unescape(j.match(/src=([^&]+)/)[1])}g=this.settings.itemWidth-40;if(c){return j}else{return a("<img />").attr({src:j,alt:i}).addClass("item_thumb").width(g)}}else{return false}},_getYoutubeVideo:function(a){return a.replace(/http:\/\/(www.)?(youtu.be\/|youtube.com\/watch\?v=)([a-zA-Z0-9?%.;:\\/=+_-]+)([&]*([a-zA-Z0-9?&%.;:\\/=+_-]*))/i,"http://www.youtube.com/v/$3?fs=1&hl=en_US")},_getYoutubeId:function(a){var b=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var c=a.match(b);if(c&&c[1].length==11){return c[1]}return false},_getVimeoVideo:function(a){return a.replace(/http:\/\/(www.)?(vimeo.com\/)([a-zA-Z0-9?%.;:\\/=+_-]+)([&]*([a-zA-Z0-9?&%.;:\\/=+_-]*))/i,"http://player.vimeo.com/video/$3")},_linkify:function(a){return a.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(a){return a.link(a)})}};a.fn.dpSocialTimeline=function(c){var d;this.each(function(){d=new b(a(this),c);a(this).data("dpSocialTimeline",d)});return this};a.fn.dpSocialTimeline.defaults={feeds:null,twitter:"",twitter_hash:"",facebook_page:"",delicious:"",flickr:"",tumblr:"",youtube:"",youtube_search:"",dribbble:"",digg:"",pinterest:"",vimeo:"",layoutMode:"timeline",addColorbox:false,showSocialIcons:true,showFilter:true,showLayout:true,showLayoutTimeline:true,showLayoutColumns:true,showLayoutOneColumn:true,itemWidth:200,timelineItemWidth:"",columnsItemWidth:"",oneColumnItemWidth:"",skin:"light",total:10};a.fn.dpSocialTimeline.settings={};a.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:10}};a.Isotope.prototype._spineAlignLayout=function(b){var c=this,d=this.spineAlign,e=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,f=Math.round(this.element.width()/2);b.each(function(){var b=a(this),g=d.colB>d.colA,h=g?f-(b.outerWidth(true)+e/2):f+e/2,i=g?d.colA:d.colB;c._pushPosition(b,h,i);if(g){b.removeClass("colB").addClass("colA")}else{b.removeClass("colA").addClass("colB")}d[g?"colA":"colB"]+=b.outerHeight(true)})};a.Isotope.prototype._spineAlignGetContainerSize=function(){var a={};a.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"];return a};a.Isotope.prototype._spineAlignResizeChanged=function(){return true}})(jQuery)